<!doctype html>
<html>
<head>
<title>Grid Layout Demo Settings</title>

<script src="js/go-debug.js"></script>
<script id="code">

	function init() {
		var $ = go.GraphObject.make;  // for conciseness in defining templates
		
		myDiagram =
			$(go.Diagram, "myDiagram",  // must be the ID or reference to div
			{
				//autoScale: go.Diagram.Uniform,
				allowMove: false,
				allowGroup: false,
				allowSelect: false,
				//allowHorizontalScroll: false,
				//allowVerticalScroll: false,
				//contentAlignment: go.Spot.Center,
				/*layout: 
					$(go.GridLayout,
					{ comparer: go.GridLayout.smartComparer })*/
					// other properties are set by the layout function, defined below
			});
			
		// define the Node template
		myDiagram.nodeTemplate =
			$(go.Part, //"Spot",
			{ 
				// make sure the Node.location is different from the Node.position
				//locationSpot: go.Spot.Center,
				locationObjectName: "SHAPE",
				click: showArrowInfo,
				toolTip:
				$(go.Adornment, "Auto",
				$(go.Shape, { fill: "#EFEFCC" }),
				$(go.TextBlock, { margin: 4 },
					new go.Binding("text", "text"))
				),
			},
			new go.Binding("location", "loc", go.Point.parse), 
			new go.Binding("text", "text"),  // for sorting
			$(go.Shape, "Card",
			{ 
				name: "SHAPE",
				fill: "lightgray",
				stroke: "black",
				desiredSize: new go.Size(25, 25),
				minSize: new go.Size(25, 25),
				//position: new go.Point(10,0)
			},
			new go.Binding("fill", "fill"),
			//new go.Binding("oldFill", "oldFill"),
			new go.Binding("desiredSize", "size")),
			$(go.TextBlock,
				// the default alignment is go.Spot.Center
				new go.Binding("text", "text"))
			);
		
		updateData(); // generate random nodes
		//layout(); // layout using the latest parameters
				
		//updateDiagramSize(35, new go.Size(1, 1));
	}
	  
	function showArrowInfo(e, obj) {
		var data = myDiagram.model.findNodeDataForKey(obj.part.text);
		var newFill = data.fill === data.oldFill ? "#33B5E5" : data.oldFill;
		myDiagram.model.setDataProperty(data, "fill", newFill);
		
		//window.alert("Clicked seat: " + obj.part.text + "\n" + data.fill);
	}
	  
	function updateData() {
		var colorGroupSize = document.getElementById("colorGroupSize").value;
		var itemCount = document.getElementById("itemCount").value;
		colorGroupSize = parseFloat(colorGroupSize, 1);
		itemCount = parseFloat(itemCount, 1);

		// create an array of data describing randomly colored and sized nodes
		var nodeDataArray = [];
		var brushColor;
		for (var i = 0; i < itemCount; i++) {
			if (i % colorGroupSize === 0) { 
				brushColor = go.Brush.randomColor(72, 255);
				//nodeDataArray[i].node.position = new go.Point(i, i);
				//var data = myDiagram.model.findNodeDataForKey(obj.part.text);
				//var newFill = data.fill === data.oldFill ? "#33B5E5" : data.oldFill;
				//myDiagram.model.setDataProperty(data, "fill", newFill);
			}
			nodeDataArray.push({
				key: i,
				text: i.toString(),
				fill: brushColor,
				oldFill: brushColor	,
				loc: i.toString() + " " + i.toString()
			});	  
		}
		
		// randomize the data
		for (i = 0; i < nodeDataArray.length; i++) {
			var swap = Math.floor(Math.random() * nodeDataArray.length);
			var temp = nodeDataArray[swap];
			nodeDataArray[swap] = nodeDataArray[i];
			nodeDataArray[i] = temp;
		}
		
		// create a Model that does not know about link or group relationships
		myDiagram.model = new go.Model(nodeDataArray);
		layout();
	  }
	  
	  // Update the layout from the controls, and then perform the layout again
	function layout() {
		myDiagram.startTransaction("change Layout");
		
		//var itemCount = document.getElementById("itemCount").value;
		var itemCount = myDiagram.model.nodeDataArray.length + 1; 
		var lay = myDiagram.layout;
		var wrappingColumn = document.getElementById("wrappingColumn").value;
		lay.wrappingColumn = parseFloat(wrappingColumn, 10);
		lay.wrappingColumn = Math.min(itemCount, lay.wrappingColumn);
		
		/*var wrappingWidth = document.getElementById("wrappingWidth").value;
		lay.wrappingWidth = parseFloat(wrappingWidth, 10);*/
		
		var cellSize = document.getElementById("cellSize").value;
		lay.cellSize = go.Size.parse(cellSize);
		
		var spacing = document.getElementById("spacing").value;
		lay.spacing = go.Size.parse(spacing);
		
		/*var alignment = getRadioValue("alignment");
		if (alignment === "Position") { lay.alignment = go.GridLayout.Position; }
		else { lay.alignment = go.GridLayout.Location; }*/
		lay.alignment = go.GridLayout.Position;
		
		var arrangement = getRadioValue("arrangement");
		if (arrangement === "LeftToRight") { lay.arrangement = go.GridLayout.LeftToRight; }
		else { lay.arrangement = go.GridLayout.RightToLeft; }
		
		var sorting = document.getElementById("sorting").value;
		switch (sorting) {
			default:
			case "Forward": lay.sorting = go.GridLayout.Forward; break;
			case "Reverse": lay.sorting = go.GridLayout.Reverse; break;
			case "Ascending": lay.sorting = go.GridLayout.Ascending; break;
			case "Descending": lay.sorting = go.GridLayout.Descending; break;
		}
		
		var div = myDiagram.div;
		var scale = myDiagram.model.scale;
		var rows = Math.ceil(itemCount/lay.wrappingColumn);
		var newHeight = (rows * 25) + (rows * lay.spacing.height);
		var newWidth = (lay.wrappingColumn * 25) + (lay.wrappingColumn * lay.spacing.width);

		div.style.width = newWidth.toString() + "px";
		div.style.height = newHeight.toString() + "px";
		myDiagram.requestUpdate();

		myDiagram.commitTransaction("change Layout");
	}
	  
	function getRadioValue(name) {
		var radio = document.getElementsByName(name);
		for (var i = 0; i < radio.length; i++) {
			if (radio[i].checked) return radio[i].value;
		}
	}

	/*function reload() {
		location.reload(false);
	}*/
</script>
</head>

<body onload="init()">
<div id="sample">
  <div style="margin-bottom: 5px; padding: 5px; background-color: aliceblue">
	<span style="display: inline-block; vertical-align: top; padding: 5px">
	  <b>GridLayout Properties</b>
	  <br />
	  Number of Items:
	  <input type="text" size="3" id="itemCount" value="315" onchange="updateData()" />
	  <br />
	  Color Group Size:
	  <input type="text" size="3" id="colorGroupSize" value="105" onchange="updateData()" />
	  <br />
	  Wrapping Column:
	  <input type="text" size="3" id="wrappingColumn" value="35" onchange="layout()" />
	  (NaN means there's no limit)
	  <br />
	  <!--Wrapping Width:
	  <input type="text" size="3" id="wrappingWidth" value="NaN" onchange="layout()" />
	  (NaN means use the diagram's viewport width)
	  <br />-->
	  Cell Size:
	  <input type="text" size="6" id="cellSize" value="NaN NaN" onchange="layout()" />
	  (NaN x NaN means use a cell size big enough to hold any node)
	  <br />
	  Spacing:
	  <input type="text" size="6" id="spacing" value="2 2" onchange="layout()" />
	  (the minimum space between the nodes)
	  <br />
	  <!--Alignment:
	  <input type="radio" name="alignment" onclick="layout()" value="Position" checked="checked" /> Position
	  <input type="radio" name="alignment" onclick="layout()" value="Location" /> Location
	  <br />-->
	  Arrangement:
	  <input type="radio" name="arrangement" onclick="layout()" value="LeftToRight" checked="checked" /> LeftToRight
	  <input type="radio" name="arrangement" onclick="layout()" value="RightToLeft" /> RightToLeft
	  <br />
	  Sorting:
	  <select name="sorting" id="sorting" onchange="layout()">
		<option value="Forward">Forward</option>
		<option value="Reverse">Reverse</option>
		<option value="Ascending" selected="selected">Ascending</option>
		<option value="Descending">Descending</option>
	  </select>
	</span>
  </div>
  <div id="myDiagram" style="background-color: white; border: solid 1px black; width: 1000px; height: 250px"></div>
</div>
</body>
</html> 